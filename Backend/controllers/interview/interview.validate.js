// interview.validate.js

/**
 * Validates an interview question generated by LLM
 * This is STRUCTURAL validation, not semantic
 */
export function validateQuestion(question) {
  if (!question) return false;

  const q = question.trim();

  // 1️⃣ Must end with a question mark
  if (!q.endsWith("?")) return false;

  // 2️⃣ Length guard (interview questions should be concise)
  if (q.length < 10 || q.length > 200) return false;

  // 3️⃣ Must contain ONLY one question
  const questionMarks = (q.match(/\?/g) || []).length;
  if (questionMarks !== 1) return false;

  // 4️⃣ Disallow instructions / coding tasks
  const bannedPhrases = [
    "explain in detail",
    "describe in detail",
    "write code",
    "implement",
    "solve",
    "multiple questions",
    "step by step",
    "in detail"
  ];

  const lower = q.toLowerCase();
  if (bannedPhrases.some(p => lower.includes(p))) {
    return false;
  }

  // 5️⃣ Prevent prompt leakage
  const leakedTokens = [
    "you are an ai",
    "as an ai",
    "according to the resume",
    "based on the resume",
    "llm",
    "model"
  ];

  if (leakedTokens.some(t => lower.includes(t))) {
    return false;
  }

  return true;
}
